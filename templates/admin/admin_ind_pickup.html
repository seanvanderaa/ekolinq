{# templates/admin_pickup_detail.html #}
{% extends "admin/admin_base.html" %}

{% block title %}Individual Pickup | EkoLinq{% endblock %}

{% block extra_head %}
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_pickup_styles.css') }}">
{% endblock %}

{% block content %}
<main class="content-width">
  <a href="{{ url_for('admin') }}" class="back-link">&larr; Back to Pickups Overview</a>
  <h1>Pickup #{{ pickup.request_id }}</h1>

  {# ---------------- Pickup Info ---------------- #}
  <section class="pickup-details grid gap-6 md:grid-cols-2">
    {# — Overview — #}
    <div class="card">
      <h2 class="card-title">Overview</h2>
      <div class="info-row">
        <span class="label">Status</span>
        <span class="value status-{{ pickup.status|lower }}">{{ pickup.status }}</span>
      </div>
      <div class="info-row"><span class="label">Date Filed</span><span class="value">{{ pickup.date_filed }}</span></div>
      <div class="info-row"><span class="label">Requested</span><span class="value">{{ pickup.request_date }} &bull; {{ pickup.request_time }}</span></div>
      <div class="info-row"><span class="label">Gated?</span><span class="value">{{ pickup.gated }}</span></div>
    </div>

    {# — Customer — #}
    <div class="card">
      <h2 class="card-title">Customer</h2>
      <div class="info-row"><span class="label">First Name</span><span class="value">{{ pickup.fname }}</span></div>
      <div class="info-row"><span class="label">Last Name</span><span class="value">{{ pickup.lname }}</span></div>
      <div class="info-row"><span class="label">Email</span><span class="value break-all">{{ pickup.email }}</span></div>
      <div class="info-row"><span class="label">Phone</span><span class="value">{{ pickup.phone_number }}</span></div>
    </div>

    {# — Address (full-width) — #}
    <div class="card md:col-span-2">
      <h2 class="card-title">Address</h2>
      <div class="info-row"><span class="label">Street</span><span class="value">{{ pickup.address }}</span></div>
      <div class="info-row"><span class="label">City</span><span class="value">{{ pickup.city }}</span></div>
      <div class="info-row"><span class="label">Zip</span><span class="value">{{ pickup.zipcode }}</span></div>
    </div>

    {# — Customer notes — #}
    <div class="card md:col-span-2">
      <h2 class="card-title">Customer Notes</h2>
      <p class="value word-break">{{ pickup.notes or '—' }}</p>
    </div>

    {# — Completion info (optional) — #}
    {% if pickup.pickup_complete_info %}
    <div class="card md:col-span-2">
      <h2 class="card-title">Completion</h2>
      <p class="value">{{ pickup.pickup_complete_info }}</p>
    </div>
    {% endif %}
  </section>

  {# ---------------- Admin Notes ---------------- #}
  <section class="admin-notes">
    <h2>Admin Notes</h2>
    <form action="{{ url_for('save_admin_notes', pickup_id=pickup.id) }}"
        method="POST"
        class="notes-form">

      {{ admin_notes_form.csrf_token }}
      <input type="hidden" name="pickup_id" value="{{ pickup.request_id }}">
      {{ admin_notes_form.admin_notes(class="notes-textarea", rows="5", placeholder="Add internal notes for this pickup...") }}
      {{ admin_notes_form.submit(class="download-btn") }}
    </form>
  </section>

  {# ---------------- Google Map ---------------- #}
  <section class="map-section">
    <h2>Pickup Location</h2>
    <div class="map-embed-wrapper">
      <iframe
        width="100%"
        height="350"
        style="border:0;"
        loading="lazy"
        allowfullscreen
        referrerpolicy="no-referrer-when-downgrade"
        src="https://www.google.com/maps?q={{ (pickup.address ~ ' ' ~ pickup.city ~ ' ' ~ pickup.zipcode)|urlencode }}&output=embed">
      </iframe>
    </div>
  </section>
</main>
{% endblock %}

{% block scripts %}
  {{ super() }}
{% endblock %}
